define(["jquery","core/str"],function(a,b){function c(){a("#id_barcode").focus(),document.getElementById("id_barcode").addEventListener("keypress",g,!1),document.getElementById("id_submitbutton").addEventListener("click",h,!1);var c=document.getElementById("id_cancel");c.value="Finish";var d=b.get_strings([{key:"assignmentdetails",component:"local_barcode"},{key:"barcodes",component:"local_barcode"},{key:"draft",component:"local_barcode"},{key:"draftandsubmissionerror",component:"local_barcode"},{key:"due",component:"local_barcode"},{key:"notsubmitted",component:"local_barcode"},{key:"scanned",component:"local_barcode"},{key:"student",component:"local_barcode"},{key:"submitted",component:"local_barcode"}]);a.when(d).done(function(a){O=a,l()})}function d(b){b.stopPropagation(),b.preventDefault();var c=e();return c&&!i()&&(a("#feedback").html(O[3]),a("#feedback-group").addClass("local-barcode-has-inform"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-success")),c&&i()&&j(c),a("#id_barcode").focus(),!1}function e(){return document.getElementById("id_barcode").value.trim()}function f(){a("#id_barcode").val("")}function g(a){var b=a.which||a.keyCode;return 13===b&&(a.stopPropagation(),a.preventDefault(),q(),s(),d(a)),!1}function h(a){return a.stopPropagation(),a.preventDefault(),q(),s(),d(a),!1}function i(){return"0"===L||"0"===M}function j(b){var c="service/upload.php?barcode=";y&&(c="../service/upload.php?barcode="),a.ajax({type:"POST",url:c+b+"&id="+x+"&revert="+L+"&ontime="+M,data:{barcode:b},success:function(a){"undefined"!=typeof a.faultCode?(z=a.faultString,H=a.faultString):(z=a.code,H=a.message,I=a.assignment,J=a.assignmentdescription,A=a.course,B=a.duedate,C=a.idformat,D=a.studentid,E=a.studentname,F=a.submissiontime,G=a.islate,N=a.reverted,u()||(r(),t())),k()},error:function(a){H="Error"},dataType:"json"})}function k(){var b=a("#feedback");b.html(H);var c=0;200===z&&("1"===N?(K=O[2],a("#feedback-group").addClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),m("revert")):(K=O[8],a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-success"),m("success"))),404===z&&(I="-"),200!==z&&(K=O[6],a("#feedback-group").removeClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-danger"),m("fail"),c=1),f(),v(c)}function l(){var b=a("#region-main"),c=a("<table></table>");c.attr("id","local-barcode-table"),c.addClass("generaltable"),c.addClass("local-barcode-table");var d=c.append("<thead></thead>"),e=d.append("<tr></tr>");e.html('<th colspan="8" class="local-barcode-th-left local-barcode-sm-hide">'+O[1]+' - (<span id="id_count">0</span> '+O[6]+')</th><th colspan="17" class="local-barcode-th-center">'+O[0]+'</th><th colspan="5" class="local-barcode-th-right">'+O[8]+'(<span id="id_submit_count">0</span>)</th>'),c.append('<tbody id="tbody"></tbody>'),b.append(c)}function m(b){for(var c="bc-"+b,d=[8,17,5],e=n(),f=a("#tbody"),g=a("<tr></tr>"),h=0;h<=2;h++){var i=a("<td></td>"),j=a("<span></span>");i.attr("colspan",d[h]),j.html(e[h]),i.append(j),0===h&&i.addClass("local-barcode-sm-hide"),2===h&&(c+=" local-barcode-td-position",j.addClass("local-barcode-visuallyhidden"),i.addClass(c)),g.append(i)}f.prepend(g)}function n(){var a="local-barcode-ontime";return G&&(a="local-barcode-islate"),[e(),I+"<br /><small>"+J.substring(0,30)+"</small><br /><small>"+A+"</small><br /><small>"+O[7]+": "+E+" / "+C+": "+D+"</small><br /><small>"+O[4]+": "+B+"&nbsp; "+O[6]+': <span class="'+a+'">'+F+"</span></small><br />",K]}function o(b){return a("#id_count").html(b),a("#id_scanned_count").html(b),!1}function p(b){return a("#id_submit_count").html(b),a("#id_submitted_count").html(b),!1}function q(){L=document.getElementById("id_reverttodraft").checked===!0?"1":"0"}function r(){document.getElementById("id_reverttodraft").checked=!1}function s(){M=document.getElementById("id_submitontime")&&document.getElementById("id_submitontime").checked===!0?"1":"0"}function t(){document.getElementById("id_submitontime").checked=!1}function u(){return document.getElementById("id_multiplescans").checked}function v(b){var c,d=P();1!==b||a("#id_submitted_count").hasClass("local-barcode-error")||w(),0===b&&(c=Q(),p(c)),a("#id_scanned_count").hasClass("local-barcode-success")||a("#id_scanned_count").addClass("local-barcode-success"),o(d)}function w(){a("#id_submitted_count").addClass("local-barcode-error")}var x,y,z,A,B,C,D,E,F,G,H="",I="-",J="",K="Not Submitted",L="0",M="0",N=0,O=[],P=function(){function a(){b+=1}var b=0;return function(){return a(),b}}(),Q=function(){function a(){b+=1}var b=0;return function(){return a(),b}}();return{init:function(a,b){c(),x=a,y=b}}});