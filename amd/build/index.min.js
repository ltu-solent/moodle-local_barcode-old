define(["jquery","core/str"],function(a,b){function c(){a("#id_barcode").focus(),document.getElementById("id_barcode").addEventListener("keypress",g,!1),document.getElementById("id_submitbutton").addEventListener("click",h,!1),v();var c=b.get_strings([{key:"assignmentdetails",component:"local_barcode"},{key:"barcodes",component:"local_barcode"},{key:"draft",component:"local_barcode"},{key:"draftandsubmissionerror",component:"local_barcode"},{key:"due",component:"local_barcode"},{key:"notsubmitted",component:"local_barcode"},{key:"scanned",component:"local_barcode"},{key:"student",component:"local_barcode"},{key:"submitted",component:"local_barcode"}]);a.when(c).done(function(a){P=a,l()})}function d(b){b.stopPropagation(),b.preventDefault();var c=e();return c&&!i()&&(a("#feedback").html(P[3]),a("#feedback-group").addClass("local-barcode-has-inform"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-success")),c&&i()&&j(c),a("#id_barcode").focus(),!1}function e(){return document.getElementById("id_barcode").value.trim()}function f(){a("#id_barcode").val("")}function g(a){var b=a.which||a.keyCode;return 13===b&&(a.stopPropagation(),a.preventDefault(),q(),s(),d(a)),!1}function h(a){return a.stopPropagation(),a.preventDefault(),q(),s(),d(a),!1}function i(){return"0"===M||"0"===N}function j(b){var c="service/upload.php?barcode=";z&&(c="../service/upload.php?barcode="),a.ajax({type:"POST",url:c+b+"&id="+y+"&revert="+M+"&ontime="+N,data:{barcode:b},success:function(a){"undefined"!=typeof a.faultCode?(A=a.faultString,I=a.faultString):(A=a.code,I=a.message,J=a.assignment,K=a.assignmentdescription,B=a.course,C=a.duedate,D=a.idformat,E=a.studentid,F=a.studentname,G=a.submissiontime,H=a.islate,O=a.reverted,u()||(r(),t())),k()},error:function(a){I="Error"},dataType:"json"})}function k(){var b=a("#feedback");b.html(I);var c=0;200===A&&("1"===O?(L=P[2],a("#feedback-group").addClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),m("revert")):(L=P[8],a("#feedback-group").removeClass("local-barcode-has-danger"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-success"),m("success"))),404===A&&(J="-"),200!==A&&(L=P[6],a("#feedback-group").removeClass("local-barcode-has-success"),a("#feedback-group").removeClass("local-barcode-has-inform"),a("#feedback-group").addClass("local-barcode-has-danger"),m("fail"),c=1),f(),w(c)}function l(){var b=a("#region-main"),c=a("<table></table>");c.attr("id","local-barcode-table"),c.addClass("generaltable"),c.addClass("local-barcode-table");var d=c.append("<thead></thead>"),e=d.append("<tr></tr>");e.html('<th colspan="8" class="local-barcode-th-left local-barcode-sm-hide">'+P[1]+' - (<span id="id_count">0</span> '+P[6]+')</th><th colspan="17" class="local-barcode-th-center">'+P[0]+'</th><th colspan="5" class="local-barcode-th-right">'+P[8]+'(<span id="id_submit_count">0</span>)</th>'),c.append('<tbody id="tbody"></tbody>'),b.append(c)}function m(b){for(var c="bc-"+b,d=[8,17,5],e=n(),f=a("#tbody"),g=a("<tr></tr>"),h=0;h<=2;h++){var i=a("<td></td>"),j=a("<span></span>");i.attr("colspan",d[h]),j.html(e[h]),i.append(j),0===h&&i.addClass("local-barcode-sm-hide"),2===h&&(c+=" local-barcode-td-position",j.addClass("local-barcode-visuallyhidden"),i.addClass(c)),g.append(i)}f.prepend(g)}function n(){var a="local-barcode-ontime";return H&&(a="local-barcode-islate"),[e(),J+"<br /><small>"+K.substring(0,30)+"</small><br /><small>"+B+"</small><br /><small>"+P[7]+": "+F+" / "+D+": "+E+"</small><br /><small>"+P[4]+": "+C+"&nbsp; "+P[6]+': <span class="'+a+'">'+G+"</span></small><br />",L]}function o(b){return a("#id_count").html(b),a("#id_scanned_count").html(b),!1}function p(b){return a("#id_submit_count").html(b),a("#id_submitted_count").html(b),!1}function q(){M=document.getElementById("id_reverttodraft").checked===!0?"1":"0"}function r(){document.getElementById("id_reverttodraft").checked=!1}function s(){N=document.getElementById("id_submitontime")&&document.getElementById("id_submitontime").checked===!0?"1":"0"}function t(){document.getElementById("id_submitontime").checked=!1}function u(){return document.getElementById("id_multiplescans").checked}function v(){a("#id_barcode").after(function(){return'<span class="local-barcode-combined-counts local-barcode-inform">(<span id="id_scanned_count">0</span> / <span id="id_submitted_count">0</span>)</span>'})}function w(b){var c,d=Q();1!==b||a("#id_submitted_count").hasClass("local-barcode-error")||x(),0===b&&(c=R(),p(c)),a("#id_scanned_count").hasClass("local-barcode-success")||a("#id_scanned_count").addClass("local-barcode-success"),o(d)}function x(){a("#id_submitted_count").addClass("local-barcode-error")}var y,z,A,B,C,D,E,F,G,H,I="",J="-",K="",L="Not Submitted",M="0",N="0",O=0,P=[],Q=function(){function a(){b+=1}var b=0;return function(){return a(),b}}(),R=function(){function a(){b+=1}var b=0;return function(){return a(),b}}();return{init:function(a,b){c(),y=a,z=b}}});